<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Benjamin Guinebertière&#39;s blog (@benjguin)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Benjamin Guinebertière&#39;s blog (@benjguin)">
<meta property="og:url" content="https://blog.3-4.fr/index.html">
<meta property="og:site_name" content="Benjamin Guinebertière&#39;s blog (@benjguin)">
<meta property="og:locale">
<meta property="article:author" content="Benjamin Guinebertière">
<meta name="twitter:card" content="summary">
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  <script type='text/javascript' src='/js/tag.js'></script>
<meta name="generator" content="Hexo 5.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Benjamin Guinebertière&#39;s blog (@benjguin)</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.3-4.fr"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2021/04/12/end-to-end-walkthrough" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/12/end-to-end-walkthrough/" class="article-date">
  <time datetime="2021-04-12T00:00:00.000Z" itemprop="datePublished">2021-04-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/12/end-to-end-walkthrough/">Why You Might Want to Have an End to End Walkthrough Document in Your Repo</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>As we are wrapping up an engagement where we’ve been coding with engineers and data scientists in a TelCo company,<br>we are sharing some of the learnings from this engagement.</p>
<p>That’s part of our team’s mission: We code with high impact organization developers to bootstrap the projects they’ll bring to production in Azure and pave the way for others.</p>
<p>You’ll learn more from the same engagement at <a target="_blank" rel="noopener" href="https://aka.ms/hat-sharing">https://aka.ms/hat-sharing</a></p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>In the engagement we were a larger team than usual. Customer had 7 developers and data scientists, 1 subject matter expert. MS brought 1 Business PM, 1 Technical PM, 1 Dev lead, 1 Data Science Lead, 2 Tech Leads (I was one of the two), 7 developers, and 2 data scientists.</p>
<p>That’s definitely more than a pizza team! (Well, we were working from home, so each team member could order a pizza for themselves and nobody starved anyway…)</p>
<p>Because the team was large we split the team based on the epics we had in the backlog. A small team of ~3 would take an epic and take ownership from design to implementation. An epic would be about data transformation pipeline, another one about data science pipeline, another one about clustering, etc. There were also cross epic design meetings.</p>
<p>An additional piece of context is that <a target="_blank" rel="noopener" href="https://github.com/microsoft/code-with-engineering-playbook/blob/master/CSE.md">Microsoft CSE (Commercial Software Engineering)</a> codes with customers. The customer team is the catcher, they move on after we leave. If we didnt come to that point when we leave, they are the ones bringing the project to production. So it’s important the code we leave is cristal clear for the catcher team.</p>
<h2 id="Impediments"><a href="#Impediments" class="headerlink" title="Impediments"></a>Impediments</h2><p>We had two important obstacles while running the engagement:</p>
<ol>
<li>Data needs evolved and the datasets we had became partially obsolete. We didn’t get the right new datasets early enough. Because of that, parts of the project used small datasets (1 day) with the new schema, while other parts of the project stayed with medium datasets (few weeks) that allowed clustering to work.</li>
<li>We didn’t get access to the target pre-production environment early enough. Because of that, we recreated a similar environment in our development Azure subscription, besides the development environment. Let’s call it the simulated target environment.</li>
</ol>
<p>Without us figuring out, the team started to progress in parallel streams that may not converge. There were unit tests, and plans to develop some integration tests. There was no clear target we could touch, no clear artifact you test, fix and enhance. There was only that mental picture each team member had on top of their mind; was the picture the same for each of us? Was the team still walking in the right and same direction?</p>
<h2 id="Integration-tests-early-in-the-game"><a href="#Integration-tests-early-in-the-game" class="headerlink" title="Integration tests early in the game"></a>Integration tests early in the game</h2><p>It was time to put higher priority on and end to end integration test running in an Azure DevOps pipeline that everyone could see, touch, fix and enhance. It was also important to have this end to end integration test to make it more obvious when we had to switch datasets. For instance, data transformation pipeline used new raw datasets (with the new schema) to go to bronze, silver and gold datasets, but the gold dataset could not be used for clustering because there was only one day of data while a few weeks were needed. The data science pipeline used an old datasets that had enough data. We still included that in the end to end integration test because the main goal was to reflect what we had built so far, and have something to fix, not be content with different parts that individually worked well.</p>
<p>If i had to run the same engagement again, I would have an integration tests Azure DevOps pipeline much earlier.</p>
<h2 id="End-to-end-walkthrough-document"><a href="#End-to-end-walkthrough-document" class="headerlink" title="End to end walkthrough document"></a>End to end walkthrough document</h2><p>The end to end integration test pipeline didn’t reflect the work from the whole team. There were people working on the development environment itself, others working on data science enhancements (what would be the best clustering algorithm, how would you interpret the clusters, how to detect concept drifts), others on data visualization. All this was not part of the integration tests pipeline.</p>
<p>We already had a lot of documentation in the repo (e.g. design documents written by the epics teams) but that still didn’t provide a quite concise yet holistic view of what was in the repo.</p>
<p>Having an end to end walkthrough document is a way to have a sequential list of things to run, test and read to get up to speed on what the repo contains. Entering the code of a repo is hard. What if we could have a tutorial that walks a new team member through the code and explains how to run it?</p>
<p>For the developers, as they write paragraphs in that document, it’s also a way to make it even more obvious how their work fits in the overall picture.</p>
<p>The end to end walkthrough document has a broader scope than the integration tests. Its central piece is about running the integration tests pipeline and documenting what it does. Offloading most of the code to Azure DevOps pipelines makes it easier to maintain the document. That’s quite obvious for the integration tests but that also works for things like dataset exploration; instead of relying on the reader to use their development environment and run code to explore datasets, why not have that code in an Azure DevOps pipeline? That makes it much easier to check that the code is still up to date (just run the pipeline).</p>
<p>So, what does such a document look like?</p>
<p>Here is the table of content of the end to end walkthrough document for the hat engagement:</p>
<ul>
<li>Development environment (how to get sources, setup and run your dev container, check that everything works correctly for you)</li>
<li>Explore datasets [1]</li>
<li>Unit Tests (how to run the unit tests from the dev environment)</li>
<li>End to end integration tests: data transformation pipeline, data science pipeline, concept drift detection pipeline, recommendation pipeline (how to run the Azure DevOps integration test pipeline and read the results)</li>
<li>Execute Data Engineering and Data Science Pipelines (how to run CD Azure DevOps pipeline and run the Databricks jobs in the target environment)</li>
<li>DataViz (how to see results in Power BI)</li>
<li>Continuous Integration - CI (understand what the CI pipeline does)</li>
<li>Continuous Deployment - CD (understand what the CD pipeline does)</li>
<li>Data Science Experiments (how to run the data science notebooks) [2]</li>
</ul>
<p>[1] an Azure DevOps pipeline is associated to that part of the document. It allows to get datasets from the dev environment’s data lake and extract schema and a few rows to get a glance on how the dataset looks like without running an actual notebook. This cannot be seen directly from Azure Data Explorer as datasets would come in formats like ORC, CSV in tar.gz or parquet.</p>
<p>[2] Data scientists worked in notebooks (experiment notebooks), then code was translated by developers into unit tested Python code + bootstrap notebooks. The experiment notebooks were stored in git in a separate folder.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>If I had to go back in time, I would have integration tests in an Azure DevOps pipeline much sooner and start the end to end walkthrough document very early also. Any important pull request that would bring new features would update both.</p>
<p>I would also use parts of the end to end walktrhough document to have descriptions of what the code would do in the near future. That’s complementary to the backlog which is at a lower level of details.</p>
<p><strong>Both the end to end walkthrough document and integration tests in an automated pipeline are a great target the whole development team can share, look at, touch, run, fix, enhance.</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.3-4.fr/2021/04/12/end-to-end-walkthrough/" data-id="ckq2umida00137nndedvo0b0i" class="article-share-link">Share</a>
      
        <a href="https://blog.3-4.fr/2021/04/12/end-to-end-walkthrough/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevPractices/" rel="tag">DevPractices</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020/09/02/docker-volumes-in-codespace" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/02/docker-volumes-in-codespace/" class="article-date">
  <time datetime="2020-09-02T00:00:00.000Z" itemprop="datePublished">2020-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/02/docker-volumes-in-codespace/">How to Share a Volume With a Specific Docker Container in Visual Studio Codespaces</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Visual Studio Codespaces provides cloud-powered development environments for any activity - whether it’s a long-term project, or a short-term task like reviewing a pull request</p>
<p>I use it to have a development environment dedicated to a repo.<br>I like it because it provides me with a Linux environment that includes most of the tools I need,<br>including Docker.  </p>
<p>You’ll find more information in the documentation at <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/visualstudio/codespaces/overview/what-is-vsonline">https://docs.microsoft.com/en-us/visualstudio/codespaces/overview/what-is-vsonline</a>.</p>
<p>One of the things I found tricky was to <code>docker run</code> with a volume that points back to my development environment.</p>
<h2 id="what-is-the-problem"><a href="#what-is-the-problem" class="headerlink" title="what is the problem?"></a>what is the problem?</h2><p>To illustrate the issue, I created a sample repo: <a target="_blank" rel="noopener" href="https://github.com/benjguin/sample200902">https://github.com/benjguin/sample200902</a></p>
<p>I create a Visual Studio Codespace for it.<br>I go to <a target="_blank" rel="noopener" href="https://online.visualstudio.com/environments">https://online.visualstudio.com/environments</a>, then <code>Create Codespace</code> with the following parameters:  </p>
<ul>
<li>Codespace Name: sample200902</li>
<li>Git Repository: <a target="_blank" rel="noopener" href="https://github.com/benjguin/sample200902.git">https://github.com/benjguin/sample200902.git</a></li>
<li>(keep default for the rest)</li>
</ul>
<p>From the command line part of Visual Studio (CTRL-`), I have:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">codespace:~&#x2F;workspace&#x2F;sample200902$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">443c621d0ef5        1da2d08caca9        &quot;&#x2F;usr&#x2F;local&#x2F;share&#x2F;do…&quot;   44 seconds ago      Up 42 seconds                           codespaces_5d85d6</span><br></pre></td></tr></table></figure>

<p>The container I see (<code>443c621d0ef5</code>) happens to be the container from which the command line executed.<br>In other words, the development environment is a container, not the docker host itself.  </p>
<p>So, if I try to run docker with a volume pointing back to my current folder, I do not see the local folder content.<br>Let’s try:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">codespace:~&#x2F;workspace&#x2F;sample200902$ docker run -it --rm -v $PWD:&#x2F;my-vol alpine sh</span><br><span class="line">&#x2F; # ls -al &#x2F;my-vol</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Sep  2 16:33 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Sep  2 16:33 ..</span><br></pre></td></tr></table></figure>

<p>Why? Because $PWD points to current working dir on the host, not on the dev container.</p>
<h2 id="How-to-workaround-it"><a href="#How-to-workaround-it" class="headerlink" title="How to workaround it?"></a>How to workaround it?</h2><p>Both development environment and container can meet in a common folder, on the docker host.</p>
<p>By inspecting our development environment we can find one:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">codespace:~&#x2F;workspace&#x2F;sample200902$ docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">443c621d0ef5        1da2d08caca9        &quot;&#x2F;usr&#x2F;local&#x2F;share&#x2F;do…&quot;   35 minutes ago      Up 35 minutes                           codespaces_5d85d6</span><br><span class="line">codespace:~&#x2F;workspace&#x2F;sample200902$ docker inspect 44 | grep containerTmp --before&#x3D;5 --after&#x3D;5</span><br><span class="line">                &quot;&#x2F;root&#x2F;.vsonline&#x2F;.vsoshared:&#x2F;home&#x2F;codespace&#x2F;.vsonline&#x2F;.vsoshared&quot;,</span><br><span class="line">                &quot;&#x2F;.vsonline&#x2F;vsoagent&#x2F;mount:&#x2F;.vsonline&#x2F;bin&quot;,</span><br><span class="line">                &quot;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;vsonlinemount&#x2F;workspace:&#x2F;home&#x2F;codespace&#x2F;workspace&quot;,</span><br><span class="line">                &quot;&#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock:ro&quot;,</span><br><span class="line">                &quot;&#x2F;usr&#x2F;bin&#x2F;docker:&#x2F;usr&#x2F;bin&#x2F;docker:ro&quot;,</span><br><span class="line">                &quot;&#x2F;mnt&#x2F;containerTmp:&#x2F;tmp&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">--</span><br><span class="line">                &quot;RW&quot;: false,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;&#x2F;mnt&#x2F;containerTmp&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;&#x2F;tmp&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure>

<p>basically, <code>/mnt/containerTmp</code> on the host is <code>/tmp</code> in the dev container.</p>
<p>So let’s try to mount <code>/mnt/containerTmp</code> in the docker container to see if we can see what’s in the dev container’s <code>/tmp</code> folder:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">codespace:~&#x2F;workspace&#x2F;sample200902$ cp some-content.txt &#x2F;tmp&#x2F;content-copy.txt</span><br><span class="line">codespace:~&#x2F;workspace&#x2F;sample2009$ docker run -it --rm -v &#x2F;mnt&#x2F;containerTmp&#x2F;:&#x2F;my-vol alpine sh</span><br><span class="line">&#x2F; # ls &#x2F;my-vol&#x2F;*.txt</span><br><span class="line">&#x2F;my-vol&#x2F;content-copy.txt</span><br><span class="line">&#x2F; # cat &#x2F;my-vol&#x2F;content-copy.txt</span><br><span class="line">hey, I&#39;m a text file in the dev environment.</span><br><span class="line">&#x2F; # </span><br></pre></td></tr></table></figure>

<p>It works. Here is what happened:</p>
<ul>
<li>Host <ul>
<li>dev container<ul>
<li>/tmp/content-copy.txt -&gt; Host /mnt/mnt/containerTmp/content-copy.txt</li>
</ul>
</li>
<li>alpine container<ul>
<li>/my-vol/content-copy.txt -&gt; Host /mnt/mnt/containerTmp/content-copy.txt</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>I had to use that in a project where we needed to interact with binary files from within the container, and be able to test from within the development environment.<br>This trick helped me!</p>
<p>:-) b</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.3-4.fr/2020/09/02/docker-volumes-in-codespace/" data-id="ckq2umid900127nnd34j98dmp" class="article-share-link">Share</a>
      
        <a href="https://blog.3-4.fr/2020/09/02/docker-volumes-in-codespace/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Containers/" rel="tag">Containers</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DevEnv/" rel="tag">DevEnv</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VisualStudioCode/" rel="tag">VisualStudioCode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2016/12/12/Sample_Flink_Code" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/12/Sample_Flink_Code/" class="article-date">
  <time datetime="2016-12-12T00:00:00.000Z" itemprop="datePublished">2016-12-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/12/Sample_Flink_Code/">Sample Flink Code That Reads From Kafka and Writes to Cassandra</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="The-context"><a href="#The-context" class="headerlink" title="The context"></a>The context</h2><p>Last summer, I started an open source project called <strong>boontadata-streams</strong>.<br>It is an environment where one can compare big data streaming engines like Apache Flink, Apache Storm or Apache Spark Streaming to name a few.</p>
<p>You can find the project at <a target="_blank" rel="noopener" href="https://github.com/boontadata/boontadata-streams/">https://github.com/boontadata/boontadata-streams/</a>.</p>
<p>As of this writing, the project contains an implementation of the scenario with Flink. </p>
<p>The principle is to have the following components: </p>
<ul>
<li>Some Python code simulates IOT objects which<ul>
<li>sends events to Kafka</li>
<li>sends its view of the truth to an Apache Cassandra database</li>
</ul>
</li>
<li>Apache Flink consumes the events from Kafka. It calculates aggregates and writes them to the Cassandra database</li>
<li>Some other Python code reads the Cassandra database to compare the results between the IOT simulator and Flink</li>
</ul>
<p>For instance, here is what we get when time windows are calculated based on <strong>processing time</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Comparing ingest device and flink for m1_sum</span><br><span class="line">--------------------------------------------------</span><br><span class="line">25 exceptions out of 25</span><br><span class="line"></span><br><span class="line">Exceptions are:</span><br><span class="line">            window_time                             device_id category  m1_sum_ingest_devicetime  m1_sum_flink  delta_m1_sum_ingestdevice_flink</span><br><span class="line">0   2016-12-05 14:51:55  90fddddf-c42c-4418-8133-fb3866fe826c    cat-1                     459.0           NaN                              NaN</span><br><span class="line">1   2016-12-05 14:52:00  90fddddf-c42c-4418-8133-fb3866fe826c    cat-1                     909.0         459.0                            450.0</span><br><span class="line">2   2016-12-05 14:52:05  90fddddf-c42c-4418-8133-fb3866fe826c    cat-1                     448.0         942.0                           -494.0</span><br><span class="line">3   2016-12-05 14:52:10  90fddddf-c42c-4418-8133-fb3866fe826c    cat-1                    1087.0         402.0                            685.0</span><br><span class="line">4   2016-12-05 14:52:15  90fddddf-c42c-4418-8133-fb3866fe826c    cat-1                     681.0        1203.0                           -522.0</span><br><span class="line">5   2016-12-05 14:52:20  90fddddf-c42c-4418-8133-fb3866fe826c    cat-1                       NaN         681.0                              NaN</span><br><span class="line">6   2016-12-05 14:51:55  90fddddf-c42c-4418-8133-fb3866fe826c    cat-2                     162.0           NaN                              NaN</span><br><span class="line">7   2016-12-05 14:52:00  90fddddf-c42c-4418-8133-fb3866fe826c    cat-2                     901.0         162.0                            739.0</span><br><span class="line">8   2016-12-05 14:52:05  90fddddf-c42c-4418-8133-fb3866fe826c    cat-2                     998.0         920.0                             78.0</span><br><span class="line">9   2016-12-05 14:52:10  90fddddf-c42c-4418-8133-fb3866fe826c    cat-2                     928.0        1033.0                           -105.0</span><br><span class="line">10  2016-12-05 14:52:15  90fddddf-c42c-4418-8133-fb3866fe826c    cat-2                     720.0         928.0                           -208.0</span><br><span class="line">11  2016-12-05 14:52:20  90fddddf-c42c-4418-8133-fb3866fe826c    cat-2                       NaN         768.0                              NaN</span><br><span class="line">12  2016-12-05 14:51:55  90fddddf-c42c-4418-8133-fb3866fe826c    cat-3                     325.0           NaN                              NaN</span><br><span class="line">13  2016-12-05 14:52:00  90fddddf-c42c-4418-8133-fb3866fe826c    cat-3                     857.0         227.0                            630.0</span><br><span class="line">14  2016-12-05 14:52:05  90fddddf-c42c-4418-8133-fb3866fe826c    cat-3                     767.0         939.0                           -172.0</span><br><span class="line">15  2016-12-05 14:52:10  90fddddf-c42c-4418-8133-fb3866fe826c    cat-3                     632.0         783.0                           -151.0</span><br><span class="line">16  2016-12-05 14:52:15  90fddddf-c42c-4418-8133-fb3866fe826c    cat-3                     415.0         632.0                           -217.0</span><br><span class="line">17  2016-12-05 14:52:20  90fddddf-c42c-4418-8133-fb3866fe826c    cat-3                       NaN         514.0                              NaN</span><br><span class="line">18  2016-12-05 14:49:50  90fddddf-c42c-4418-8133-fb3866fe826c    cat-4                      49.0           NaN                              NaN</span><br><span class="line">19  2016-12-05 14:51:55  90fddddf-c42c-4418-8133-fb3866fe826c    cat-4                     589.0           NaN                              NaN</span><br><span class="line">20  2016-12-05 14:52:00  90fddddf-c42c-4418-8133-fb3866fe826c    cat-4                    1078.0         589.0                            489.0</span><br><span class="line">21  2016-12-05 14:52:05  90fddddf-c42c-4418-8133-fb3866fe826c    cat-4                    1310.0        1156.0                            154.0</span><br><span class="line">22  2016-12-05 14:52:10  90fddddf-c42c-4418-8133-fb3866fe826c    cat-4                     905.0        1238.0                           -333.0</span><br><span class="line">23  2016-12-05 14:52:15  90fddddf-c42c-4418-8133-fb3866fe826c    cat-4                     693.0        1079.0                           -386.0</span><br><span class="line">24  2016-12-05 14:52:20  90fddddf-c42c-4418-8133-fb3866fe826c    cat-4                       NaN         820.0                              NaN</span><br></pre></td></tr></table></figure>


<p>and here is what we get when extracting time from the event data (<strong>event time</strong>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Comparing ingest device and flink for m1_sum</span><br><span class="line">--------------------------------------------------</span><br><span class="line">5 exceptions out of 21</span><br><span class="line"></span><br><span class="line">Exceptions are:</span><br><span class="line">            window_time                             device_id category  m1_sum_ingest_devicetime  m1_sum_flink  delta_m1_sum_ingestdevice_flink</span><br><span class="line">4   2016-12-05 14:53:35  b8c0c5c4-9189-4a0d-a96b-55ca4adafe14    cat-1                       388           NaN                              NaN</span><br><span class="line">9   2016-12-05 14:53:35  b8c0c5c4-9189-4a0d-a96b-55ca4adafe14    cat-2                       496           NaN                              NaN</span><br><span class="line">14  2016-12-05 14:53:35  b8c0c5c4-9189-4a0d-a96b-55ca4adafe14    cat-3                       296           NaN                              NaN</span><br><span class="line">15  2016-12-05 14:51:10  b8c0c5c4-9189-4a0d-a96b-55ca4adafe14    cat-4                        49           NaN                              NaN</span><br><span class="line">20  2016-12-05 14:53:35  b8c0c5c4-9189-4a0d-a96b-55ca4adafe14    cat-4                       537           NaN                              NaN</span><br></pre></td></tr></table></figure>

<p>this second result is better. All the differences can be explained:<br>those with the <code>2016-12-05 14:53:35</code> time window happen because no further event was sent that could trigger the calculation of this time Window;<br>the <code>2016-12-05 14:51:10</code> time window for <code>cat4</code> corresponds to an event that was sent too late by the IOT simulator (on purpose) so that the streaming engine cannot take it into account.</p>
<p>You can see the <a target="_blank" rel="noopener" href="https://github.com/boontadata/boontadata-streams/raw/7a09d63b5b73edb792f0821f8aa2408a770326d9/doc/sample_execution_log.md">full execution log in GitHub</a>. </p>
<p>Here are the versions used in the current implementation: </p>
<hr>
<table>
<thead>
<tr>
<th>Component</th>
<th>version</th>
<th>comments</th>
</tr>
</thead>
<tbody><tr>
<td>Python</td>
<td>Python 3.5.2</td>
<td>Anaconda 4.2.0 (64-bit)</td>
</tr>
<tr>
<td>Apache Kafka</td>
<td>0.10</td>
<td></td>
</tr>
<tr>
<td>Apache Flink</td>
<td>1.1.3</td>
<td></td>
</tr>
<tr>
<td>Apache Cassandra</td>
<td>3.9</td>
<td></td>
</tr>
<tr>
<td>Apache Zookeeper</td>
<td>3.4.9</td>
<td></td>
</tr>
</tbody></table>
<p>The project leverages Docker containers, it can run on a single Ubuntu VM with ~14 GB of RAM.<br>Of course, you are welcome to contribute. We may even let you use one of our Azure VMs while you develop. You can contact me: <code>contact à boontadata.io</code>. </p>
<h2 id="The-pom-and-the-code"><a href="#The-pom-and-the-code" class="headerlink" title="The pom and the code"></a>The pom and the code</h2><p>In order to write that, I relied on sample code on the Internet about Flink consuming Kafka and Flink writing to Cassandra.<br>Still, it took me some time to put everything together. </p>
<p>What I consumed most of my time on was the Maven configuration file: <a target="_blank" rel="noopener" href="https://github.com/boontadata/boontadata-streams/blob/master/code/flink/master/code/pom.xml">pom.xml</a>.</p>
<p>I’m not a Java specialist, so I gave up on the JAR size optimization and preferred to have a <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/11947037/what-is-an-uber-jar">uber-jar</a>.</p>
<p>I couldn’t make the Kafka 0.10 client working so I used Kafka 0.8.2. This version of the client needs to communicate to Zookeeper. Still, it can read from Kafa 0.10.</p>
<p>In terms of <a target="_blank" rel="noopener" href="https://github.com/boontadata/boontadata-streams/tree/master/code/flink/master/code/src/main/java/io/boontadata/flink1">Flink code</a>, I created a pipeline that does the following: </p>
<ul>
<li>reads from Kafka</li>
<li>parses message</li>
<li>assigns timestamp and watermarks from event data</li>
<li>creates a time window in order to remove duplicates (the key is the <code>message id</code>)</li>
<li>creates a time window in order to aggregate (based on <code>device id</code>, <code>message category</code>)</li>
<li>sends some debugging information to Cassandra <code>debug</code> table about events and their time windows</li>
<li>aggredates data</li>
<li>writes results to Cassandra <code>agg_events</code> table</li>
</ul>
<p>Feel free to visit the <a target="_blank" rel="noopener" href="https://github.com/boontadata/boontadata-streams">GitHub repo</a>, or use the code as samples, or fix it and create a pull request when you find ways to improve it, or add your own implementation on other streaming engines like Storm, Spark streaming or others.</p>
<h2 id="A-copy-of-the-most-significant-pieces-of-code"><a href="#A-copy-of-the-most-significant-pieces-of-code" class="headerlink" title="A copy of the most significant pieces of code"></a>A copy of the most significant pieces of code</h2><p>The rest of this post is a copy of the most significant pieces of code</p>
<p>pom.xml:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;groupId&gt;io.boontadata.flink1&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;flink1&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;version&gt;0.1&lt;&#x2F;version&gt;</span><br><span class="line">	&lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">	&lt;name&gt;Flink flink1 Job&lt;&#x2F;name&gt;</span><br><span class="line">	&lt;url&gt;http:&#x2F;&#x2F;boontadata.io&lt;&#x2F;url&gt;</span><br><span class="line"></span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">		&lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">		&lt;flink.version&gt;1.1.3&lt;&#x2F;flink.version&gt;</span><br><span class="line">	&lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">	&lt;repositories&gt;</span><br><span class="line">		&lt;repository&gt;</span><br><span class="line">			&lt;id&gt;apache.snapshots&lt;&#x2F;id&gt;</span><br><span class="line">			&lt;name&gt;Apache Development Snapshot Repository&lt;&#x2F;name&gt;</span><br><span class="line">			&lt;url&gt;https:&#x2F;&#x2F;repository.apache.org&#x2F;content&#x2F;repositories&#x2F;snapshots&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">			&lt;releases&gt;</span><br><span class="line">				&lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">			&lt;&#x2F;releases&gt;</span><br><span class="line">			&lt;snapshots&gt;</span><br><span class="line">				&lt;enabled&gt;true&lt;&#x2F;enabled&gt;</span><br><span class="line">			&lt;&#x2F;snapshots&gt;</span><br><span class="line">		&lt;&#x2F;repository&gt;</span><br><span class="line">	&lt;&#x2F;repositories&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;flink-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;flink-clients_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;flink-streaming-java_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;flink-connector-kafka-0.8_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;flink-connector-cassandra_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">	&lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">	&lt;build&gt;</span><br><span class="line">		&lt;plugins&gt;</span><br><span class="line">			&lt;plugin&gt;</span><br><span class="line">				&lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;maven-dependency-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">				&lt;version&gt;2.9&lt;&#x2F;version&gt;</span><br><span class="line">				&lt;executions&gt;</span><br><span class="line">					&lt;execution&gt;</span><br><span class="line">						&lt;id&gt;unpack&lt;&#x2F;id&gt;</span><br><span class="line">						&lt;!-- executed just before the package phase --&gt;</span><br><span class="line">						&lt;phase&gt;prepare-package&lt;&#x2F;phase&gt;</span><br><span class="line">						&lt;goals&gt;</span><br><span class="line">							&lt;goal&gt;unpack&lt;&#x2F;goal&gt;</span><br><span class="line">						&lt;&#x2F;goals&gt;</span><br><span class="line">						&lt;configuration&gt;</span><br><span class="line">							&lt;artifactItems&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;flink-clients_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;org&#x2F;apache&#x2F;flink&#x2F;client&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;flink-streaming-java_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;org&#x2F;apache&#x2F;flink&#x2F;streaming&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;flink-connector-kafka-base_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;org&#x2F;apache&#x2F;flink&#x2F;streaming&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;flink-connector-kafka-0.8_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;org&#x2F;apache&#x2F;flink&#x2F;streaming&#x2F;connectors&#x2F;kafka&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;flink-streaming-java_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;org&#x2F;apache&#x2F;flink&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;org.apache.kafka&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;kafka_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;0.8.2.2&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;kafka&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;com.101tec&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;zkclient&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;0.8&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;org&#x2F;I0Itec&#x2F;zkclient\&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;flink-connector-cassandra_2.11&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;$&#123;flink.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;org&#x2F;apache&#x2F;flink&#x2F;**,com&#x2F;datastax&#x2F;driver&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;com.yammer.metrics&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;metrics-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;2.2.0&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;com&#x2F;yammer&#x2F;metrics&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">								&lt;artifactItem&gt;</span><br><span class="line">									&lt;groupId&gt;org.apache.servicemix.bundles&lt;&#x2F;groupId&gt;</span><br><span class="line">									&lt;artifactId&gt;org.apache.servicemix.bundles.kafka-clients&lt;&#x2F;artifactId&gt;</span><br><span class="line">									&lt;version&gt;0.8.2.2_1&lt;&#x2F;version&gt;</span><br><span class="line">									&lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">									&lt;overWrite&gt;true&lt;&#x2F;overWrite&gt;</span><br><span class="line">									&lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">									&lt;includes&gt;org&#x2F;apache&#x2F;kafka&#x2F;**&lt;&#x2F;includes&gt;</span><br><span class="line">								&lt;&#x2F;artifactItem&gt;</span><br><span class="line">							&lt;&#x2F;artifactItems&gt;</span><br><span class="line">						&lt;&#x2F;configuration&gt;</span><br><span class="line">					&lt;&#x2F;execution&gt;</span><br><span class="line">				&lt;&#x2F;executions&gt;</span><br><span class="line">			&lt;&#x2F;plugin&gt;					</span><br><span class="line">			&lt;plugin&gt;</span><br><span class="line">				&lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">				&lt;version&gt;3.1&lt;&#x2F;version&gt;</span><br><span class="line">				&lt;configuration&gt;</span><br><span class="line">					&lt;source&gt;1.8&lt;&#x2F;source&gt; &lt;!-- If you want to use Java 8, change this to &quot;1.8&quot; --&gt;</span><br><span class="line">					&lt;target&gt;1.8&lt;&#x2F;target&gt; &lt;!-- If you want to use Java 8, change this to &quot;1.8&quot; --&gt;</span><br><span class="line">				&lt;&#x2F;configuration&gt;</span><br><span class="line">			&lt;&#x2F;plugin&gt;</span><br><span class="line">		&lt;&#x2F;plugins&gt;</span><br><span class="line"></span><br><span class="line">		&lt;!-- If you want to use Java 8 Lambda Expressions uncomment the following lines --&gt;</span><br><span class="line">		&lt;pluginManagement&gt;</span><br><span class="line">			&lt;plugins&gt;</span><br><span class="line">				&lt;plugin&gt;</span><br><span class="line">					&lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">					&lt;configuration&gt;</span><br><span class="line">						&lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">						&lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">						&lt;compilerId&gt;jdt&lt;&#x2F;compilerId&gt;</span><br><span class="line">					&lt;&#x2F;configuration&gt;</span><br><span class="line">					&lt;dependencies&gt;</span><br><span class="line">						&lt;dependency&gt;</span><br><span class="line">							&lt;groupId&gt;org.eclipse.tycho&lt;&#x2F;groupId&gt;</span><br><span class="line">							&lt;artifactId&gt;tycho-compiler-jdt&lt;&#x2F;artifactId&gt;</span><br><span class="line">							&lt;version&gt;0.21.0&lt;&#x2F;version&gt;</span><br><span class="line">						&lt;&#x2F;dependency&gt;</span><br><span class="line">					&lt;&#x2F;dependencies&gt;</span><br><span class="line">				&lt;&#x2F;plugin&gt;</span><br><span class="line">				&lt;plugin&gt;</span><br><span class="line">					&lt;groupId&gt;org.eclipse.m2e&lt;&#x2F;groupId&gt;</span><br><span class="line">					&lt;artifactId&gt;lifecycle-mapping&lt;&#x2F;artifactId&gt;</span><br><span class="line">					&lt;version&gt;1.0.0&lt;&#x2F;version&gt;</span><br><span class="line">					&lt;configuration&gt;</span><br><span class="line">						&lt;lifecycleMappingMetadata&gt;</span><br><span class="line">							&lt;pluginExecutions&gt;</span><br><span class="line">								&lt;pluginExecution&gt;</span><br><span class="line">									&lt;pluginExecutionFilter&gt;</span><br><span class="line">										&lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">										&lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">										&lt;versionRange&gt;[2.4,)&lt;&#x2F;versionRange&gt;</span><br><span class="line">										&lt;goals&gt;</span><br><span class="line">											&lt;goal&gt;single&lt;&#x2F;goal&gt;</span><br><span class="line">										&lt;&#x2F;goals&gt;</span><br><span class="line">									&lt;&#x2F;pluginExecutionFilter&gt;</span><br><span class="line">									&lt;action&gt;</span><br><span class="line">										&lt;ignore&#x2F;&gt;</span><br><span class="line">									&lt;&#x2F;action&gt;</span><br><span class="line">								&lt;&#x2F;pluginExecution&gt;</span><br><span class="line">								&lt;pluginExecution&gt;</span><br><span class="line">									&lt;pluginExecutionFilter&gt;</span><br><span class="line">										&lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">										&lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">										&lt;versionRange&gt;[3.1,)&lt;&#x2F;versionRange&gt;</span><br><span class="line">										&lt;goals&gt;</span><br><span class="line">											&lt;goal&gt;testCompile&lt;&#x2F;goal&gt;</span><br><span class="line">											&lt;goal&gt;compile&lt;&#x2F;goal&gt;</span><br><span class="line">										&lt;&#x2F;goals&gt;</span><br><span class="line">									&lt;&#x2F;pluginExecutionFilter&gt;</span><br><span class="line">									&lt;action&gt;</span><br><span class="line">										&lt;ignore&#x2F;&gt;</span><br><span class="line">									&lt;&#x2F;action&gt;</span><br><span class="line">								&lt;&#x2F;pluginExecution&gt;</span><br><span class="line">							&lt;&#x2F;pluginExecutions&gt;</span><br><span class="line">						&lt;&#x2F;lifecycleMappingMetadata&gt;</span><br><span class="line">					&lt;&#x2F;configuration&gt;</span><br><span class="line">				&lt;&#x2F;plugin&gt;</span><br><span class="line">			&lt;&#x2F;plugins&gt;</span><br><span class="line">		&lt;&#x2F;pluginManagement&gt;</span><br><span class="line">	&lt;&#x2F;build&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>StreamingJob.java:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line">package io.boontadata.flink1;</span><br><span class="line"></span><br><span class="line">import com.datastax.driver.core.Cluster;</span><br><span class="line">import java.lang.Double;</span><br><span class="line">import java.lang.Long;</span><br><span class="line">import java.text.Format;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.time.Instant;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.Iterator;</span><br><span class="line">import java.util.Properties;</span><br><span class="line">import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line">import org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line">import org.apache.flink.api.common.functions.ReduceFunction;</span><br><span class="line">import org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple5;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple6;</span><br><span class="line">import org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line">import org.apache.flink.streaming.api.datastream.WindowedStream;</span><br><span class="line">import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line">import org.apache.flink.streaming.api.functions.sink.SinkFunction;</span><br><span class="line">import org.apache.flink.streaming.api.functions.source.RichParallelSourceFunction;</span><br><span class="line">import org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line">import org.apache.flink.streaming.api.TimeCharacteristic;</span><br><span class="line">import org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line">import org.apache.flink.streaming.api.windowing.windows.Window;</span><br><span class="line">import org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line">import org.apache.flink.streaming.connectors.cassandra.CassandraTupleSink;</span><br><span class="line">import org.apache.flink.streaming.connectors.cassandra.ClusterBuilder;</span><br><span class="line">import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer082;</span><br><span class="line">import org.apache.flink.util.Collector;</span><br><span class="line">import org.apache.flink.streaming.util.serialization.SimpleStringSchema;</span><br><span class="line"></span><br><span class="line">import static java.util.concurrent.TimeUnit.MILLISECONDS;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Skeleton for a Flink Streaming Job.</span><br><span class="line"> *</span><br><span class="line"> * For a full example of a Flink Streaming Job, see the SocketTextStreamWordCount.java</span><br><span class="line"> * file in the same package&#x2F;directory or have a look at the website.</span><br><span class="line"> *</span><br><span class="line"> * You can also generate a .jar file that you can submit on your Flink</span><br><span class="line"> * cluster.</span><br><span class="line"> * Just type</span><br><span class="line"> * 		mvn clean package</span><br><span class="line"> * in the projects root directory.</span><br><span class="line"> * You will find the jar in</span><br><span class="line"> * 		target&#x2F;quickstart-0.1.jar</span><br><span class="line"> * From the CLI you can then run</span><br><span class="line"> * 		.&#x2F;bin&#x2F;flink run -c io.boontadata.flink1.StreamingJob target&#x2F;quickstart-0.1.jar</span><br><span class="line"> *</span><br><span class="line"> * For more information on the CLI see:</span><br><span class="line"> *</span><br><span class="line"> * http:&#x2F;&#x2F;flink.apache.org&#x2F;docs&#x2F;latest&#x2F;apis&#x2F;cli.html</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class StreamingJob &#123;</span><br><span class="line">	private static final String VERSION &#x3D; &quot;161205a&quot;;</span><br><span class="line"></span><br><span class="line">	private static final Integer FIELD_MESSAGE_ID &#x3D; 0;</span><br><span class="line">	private static final Integer FIELD_DEVICE_ID &#x3D; 1;</span><br><span class="line">	private static final Integer FIELD_TIMESTAMP &#x3D; 2;</span><br><span class="line">	private static final Integer FIELD_CATEGORY &#x3D; 3;</span><br><span class="line">	private static final Integer FIELD_MEASURE1 &#x3D; 4;</span><br><span class="line">	private static final Integer FIELD_MESAURE2 &#x3D; 5; </span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) throws Exception &#123;</span><br><span class="line">		String timeCharacteristic &#x3D; &quot;EventTime&quot;;</span><br><span class="line">		if (args.length &gt; 0) &#123;</span><br><span class="line">			timeCharacteristic &#x3D; args[0];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; set up the streaming execution environment</span><br><span class="line">		final StreamExecutionEnvironment env &#x3D; StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">		env.enableCheckpointing(5000); &#x2F;&#x2F; checkpoint every 5000 msecs</span><br><span class="line">		env.setParallelism(2);</span><br><span class="line">		</span><br><span class="line">		if (timeCharacteristic.equals(&quot;EventTime&quot;)) &#123;</span><br><span class="line">			env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span><br><span class="line">		&#125; else if (timeCharacteristic.equals(&quot;ProcessingTime&quot;)) &#123;</span><br><span class="line">			env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime);</span><br><span class="line">		&#125; else if (timeCharacteristic.equals(&quot;IngestionTime&quot;)) &#123;</span><br><span class="line">			env.setStreamTimeCharacteristic(TimeCharacteristic.IngestionTime);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Format windowTimeFormat &#x3D; new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; properties about Kafka</span><br><span class="line">		Properties kProperties &#x3D; new Properties();</span><br><span class="line">		kProperties.setProperty(&quot;bootstrap.servers&quot;, &quot;ks1:9092,ks2:9092,ks3:9092&quot;);</span><br><span class="line">		kProperties.setProperty(&quot;zookeeper.connect&quot;, &quot;zk1:2181&quot;);</span><br><span class="line">		kProperties.setProperty(&quot;group.id&quot;, &quot;flinkGroup&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; get data from Kafka, parse, and assign time and watermarks</span><br><span class="line">		DataStream&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt; stream_parsed_with_timestamps &#x3D; env </span><br><span class="line">			.addSource(new FlinkKafkaConsumer082&lt;&gt;(</span><br><span class="line">                                &quot;sampletopic&quot;,</span><br><span class="line">                                new SimpleStringSchema(),</span><br><span class="line">                                kProperties))</span><br><span class="line">			.rebalance()</span><br><span class="line">			.map(</span><br><span class="line">				new MapFunction&lt;String, </span><br><span class="line">					Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt;() &#123;</span><br><span class="line">					private static final long serialVersionUID &#x3D; 34_2016_10_19_001L;</span><br><span class="line"></span><br><span class="line">					@Override</span><br><span class="line">					public Tuple6&lt;String, String, Long, String, Long, Double&gt; map(String value) throws Exception &#123;</span><br><span class="line">						String[] splits &#x3D; value.split(&quot;\\|&quot;);</span><br><span class="line">						return new Tuple6&lt;String, String, Long, String, Long, Double&gt;(</span><br><span class="line">							splits[FIELD_MESSAGE_ID], </span><br><span class="line">							splits[FIELD_DEVICE_ID],</span><br><span class="line">							Long.parseLong(splits[FIELD_TIMESTAMP]),</span><br><span class="line">							splits[FIELD_CATEGORY],</span><br><span class="line">							Long.parseLong(splits[FIELD_MEASURE1]),</span><br><span class="line">							Double.parseDouble(splits[FIELD_MESAURE2])</span><br><span class="line">						);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			)</span><br><span class="line">			.assignTimestampsAndWatermarks(new BoundedOutOfOrdernessGenerator());</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; deduplicate on message ID</span><br><span class="line">		WindowedStream stream_windowed_for_deduplication &#x3D; stream_parsed_with_timestamps</span><br><span class="line">			.keyBy(FIELD_MESSAGE_ID)</span><br><span class="line">			.timeWindow(Time.of(5000, MILLISECONDS), Time.of(5000, MILLISECONDS));</span><br><span class="line"></span><br><span class="line">		DataStream&lt;Tuple6&lt;String,String,Long,String,Long,Double&gt;&gt; stream_deduplicated &#x3D; stream_windowed_for_deduplication			</span><br><span class="line">			.apply(new WindowFunction&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;, </span><br><span class="line">				Tuple6&lt;String, String, Long, String, Long, Double&gt;, Tuple, TimeWindow&gt;() &#123;</span><br><span class="line">				&#x2F;&#x2F; remove duplicates. cf http:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;35599069&#x2F;apache-flink-0-10-how-to-get-the-first-occurence-of-a-composite-key-from-an-unbo</span><br><span class="line">				</span><br><span class="line">				@Override</span><br><span class="line">				public void apply(Tuple tuple, TimeWindow window, Iterable&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt; input, </span><br><span class="line">					Collector&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt; out) throws Exception &#123;</span><br><span class="line">					out.collect(input.iterator().next());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; Group by device ID, Category</span><br><span class="line">		WindowedStream stream_windowed_for_groupby &#x3D; stream_deduplicated</span><br><span class="line">			.keyBy(FIELD_DEVICE_ID, FIELD_CATEGORY)</span><br><span class="line">			.timeWindow(Time.of(5000, MILLISECONDS), Time.of(5000, MILLISECONDS));</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; add debug information on stream_windowed_for_groupby</span><br><span class="line">		stream_windowed_for_groupby</span><br><span class="line">			.apply(new WindowFunction&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;, </span><br><span class="line">				Tuple2&lt;String, String&gt;, Tuple, TimeWindow&gt;() &#123;</span><br><span class="line"></span><br><span class="line">				@Override</span><br><span class="line">				public void apply(Tuple keyTuple, TimeWindow window, Iterable&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt; input, </span><br><span class="line">					Collector&lt;Tuple2&lt;String, String&gt;&gt; out) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">					for(Iterator&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt; i&#x3D;input.iterator(); i.hasNext();) &#123;</span><br><span class="line">                                                Tuple6&lt;String, String, Long, String, Long, Double&gt; value &#x3D; i.next();</span><br><span class="line"></span><br><span class="line">						out.collect(new Tuple2&lt;String, String&gt;(</span><br><span class="line">							&quot;v&quot; + VERSION + &quot;- stream_windowed_for_groupby - &quot; + Instant.now().toString(), </span><br><span class="line">							&quot;MESSAGE_ID&#x3D;&quot; + value.getField(0).toString() + &quot;, &quot;</span><br><span class="line">							+ &quot;DEVICE_ID&#x3D;&quot; + value.getField(1).toString() + &quot;, &quot;</span><br><span class="line">							+ &quot;TIMESTAMP&#x3D;&quot; + value.getField(2).toString() + &quot;, &quot;</span><br><span class="line">							+ &quot;time window start&#x3D;&quot; + (new Long(window.getStart()).toString()) + &quot;, &quot;</span><br><span class="line">							+ &quot;time window end&#x3D;&quot; + (new Long(window.getEnd()).toString()) + &quot;, &quot;</span><br><span class="line">							+ &quot;CATEGORY&#x3D;&quot; + value.getField(3).toString() + &quot;, &quot;</span><br><span class="line">							+ &quot;M1&#x3D;&quot; + value.getField(4).toString() + &quot;, &quot;</span><br><span class="line">							+ &quot;M2&#x3D;&quot; + value.getField(5).toString()</span><br><span class="line">						));</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">			.addSink(new CassandraTupleSink&lt;Tuple2&lt;String, String&gt;&gt;(</span><br><span class="line">                                &quot;INSERT INTO boontadata.debug&quot;</span><br><span class="line">                                        + &quot; (id, message)&quot;</span><br><span class="line">                                        + &quot; VALUES (?, ?);&quot;,</span><br><span class="line">                                new ClusterBuilder() &#123;</span><br><span class="line">                                        @Override</span><br><span class="line">                                        public Cluster buildCluster(Cluster.Builder builder) &#123;</span><br><span class="line">                                                return builder</span><br><span class="line">                                                        .addContactPoint(&quot;cassandra1&quot;).withPort(9042)</span><br><span class="line">                                                        .addContactPoint(&quot;cassandra2&quot;).withPort(9042)</span><br><span class="line">                                                        .addContactPoint(&quot;cassandra3&quot;).withPort(9042)</span><br><span class="line">                                                        .build();</span><br><span class="line">                                        &#125;</span><br><span class="line">                                &#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; calculate sums for M1 and M2</span><br><span class="line">		DataStream&lt;Tuple5&lt;String, String, String, Long, Double&gt;&gt; stream_with_aggregations &#x3D; stream_windowed_for_groupby</span><br><span class="line">			.apply(new WindowFunction&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;, </span><br><span class="line">				Tuple5&lt;String, String, String, Long, Double&gt;, Tuple, TimeWindow&gt;() &#123;</span><br><span class="line">			        &#x2F;&#x2F; sum measures 1 and 2</span><br><span class="line"></span><br><span class="line">				@Override</span><br><span class="line">				public void apply(Tuple keyTuple, TimeWindow window, Iterable&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt; input, </span><br><span class="line">					Collector&lt;Tuple5&lt;String, String, String, Long, Double&gt;&gt; out) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">					long window_timestamp_milliseconds &#x3D; window.getEnd();</span><br><span class="line">					String device_id&#x3D;keyTuple.getField(0); &#x2F;&#x2F; DEVICE_ID</span><br><span class="line">					String category&#x3D;keyTuple.getField(1); &#x2F;&#x2F; CATEGORY</span><br><span class="line">					long sum_of_m1&#x3D;0L;</span><br><span class="line">					Double sum_of_m2&#x3D;0.0d;</span><br><span class="line"></span><br><span class="line">					for(Iterator&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt; i&#x3D;input.iterator(); i.hasNext();) &#123;</span><br><span class="line">                                                Tuple6&lt;String, String, Long, String, Long, Double&gt; item &#x3D; i.next();</span><br><span class="line">						sum_of_m1 +&#x3D; item.f4; &#x2F;&#x2F; FIELD_MEASURE1</span><br><span class="line">						sum_of_m2 +&#x3D; item.f5; &#x2F;&#x2F; FIELD_MESAURE2</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					out.collect(new Tuple5&lt;String, String, String, Long, Double&gt;(</span><br><span class="line">								windowTimeFormat.format(new Date(window_timestamp_milliseconds)),</span><br><span class="line">								device_id, </span><br><span class="line">								category,</span><br><span class="line">								sum_of_m1,</span><br><span class="line">								sum_of_m2</span><br><span class="line">							));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; send aggregations to destination</span><br><span class="line">		stream_with_aggregations</span><br><span class="line">			.addSink(new CassandraTupleSink&lt;Tuple5&lt;String, String, String, Long, Double&gt;&gt;(</span><br><span class="line">                                &quot;INSERT INTO boontadata.agg_events&quot;</span><br><span class="line">                                        + &quot; (window_time, device_id, category, m1_sum_flink, m2_sum_flink)&quot;</span><br><span class="line">                                        + &quot; VALUES (?, ?, ?, ?, ?);&quot;,</span><br><span class="line">                                new ClusterBuilder() &#123;</span><br><span class="line">                                        @Override</span><br><span class="line">                                        public Cluster buildCluster(Cluster.Builder builder) &#123;</span><br><span class="line">                                                return builder</span><br><span class="line">                                                        .addContactPoint(&quot;cassandra1&quot;).withPort(9042)</span><br><span class="line">                                                        .addContactPoint(&quot;cassandra2&quot;).withPort(9042)</span><br><span class="line">                                                        .addContactPoint(&quot;cassandra3&quot;).withPort(9042)</span><br><span class="line">                                                        .build();</span><br><span class="line">                                        &#125;</span><br><span class="line">                                &#125;));</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; execute program</span><br><span class="line">		env.execute(&quot;io.boontadata.flink1.StreamingJob v&quot; + VERSION + &quot; (&quot; + timeCharacteristic + &quot;)&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BoundedOutOfOrdernessGenerator.java:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package io.boontadata.flink1;</span><br><span class="line"></span><br><span class="line">import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line">import org.apache.flink.api.common.functions.ReduceFunction;</span><br><span class="line">import org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple5;</span><br><span class="line">import org.apache.flink.api.java.tuple.Tuple6;</span><br><span class="line">import org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line">import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line">import org.apache.flink.streaming.api.functions.AssignerWithPeriodicWatermarks;</span><br><span class="line">import org.apache.flink.streaming.api.functions.sink.SinkFunction;</span><br><span class="line">import org.apache.flink.streaming.api.functions.source.RichParallelSourceFunction;</span><br><span class="line">import org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line">import org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line">import org.apache.flink.streaming.api.windowing.windows.Window;</span><br><span class="line">import org.apache.flink.util.Collector;</span><br><span class="line">import org.apache.flink.streaming.api.watermark.Watermark;</span><br><span class="line"></span><br><span class="line">import static java.util.concurrent.TimeUnit.MILLISECONDS;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; cf https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.1&#x2F;apis&#x2F;streaming&#x2F;event_timestamps_watermarks.html</span><br><span class="line">&#x2F;**</span><br><span class="line"> * This generator generates watermarks assuming that elements come out of order to a certain degree only.</span><br><span class="line"> * The latest elements for a certain timestamp t will arrive at most n milliseconds after the earliest</span><br><span class="line"> * elements for timestamp t.</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class BoundedOutOfOrdernessGenerator implements AssignerWithPeriodicWatermarks&lt;Tuple6&lt;String, String, Long, String, Long, Double&gt;&gt; &#123;</span><br><span class="line">    private final long maxOutOfOrderness &#x3D; 1_000L; &#x2F;&#x2F; 1 second</span><br><span class="line">    private long currentMaxTimestamp &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public long extractTimestamp(Tuple6&lt;String, String, Long, String, Long, Double&gt; element, long previousElementTimestamp) &#123;</span><br><span class="line">        long timestamp &#x3D; element.f2; &#x2F;&#x2F; get processing timestamp from current event</span><br><span class="line">        currentMaxTimestamp &#x3D; Math.max(timestamp, currentMaxTimestamp);</span><br><span class="line">        return timestamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Watermark getCurrentWatermark() &#123;</span><br><span class="line">        &#x2F;&#x2F; return the watermark as current highest timestamp minus the out-of-orderness bound</span><br><span class="line">        return new Watermark(currentMaxTimestamp - maxOutOfOrderness);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>:-) b</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.3-4.fr/2016/12/12/Sample_Flink_Code/" data-id="ckq2umidc00167nnd86d8f6k3" class="article-share-link">Share</a>
      
        <a href="https://blog.3-4.fr/2016/12/12/Sample_Flink_Code/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Azure/" rel="tag">Azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BigData/" rel="tag">BigData</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IoT/" rel="tag">IoT</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2016/09/05/IOT_Hub_Azure_Functions_Sigfox" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/05/IOT_Hub_Azure_Functions_Sigfox/" class="article-date">
  <time datetime="2016-09-05T00:00:00.000Z" itemprop="datePublished">2016-09-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/05/IOT_Hub_Azure_Functions_Sigfox/">Tutoriel - Synchronisation De Votre Application De Fonction Avec Le Concentrateur IoT Et Exemple De Connexion Avec Un Objet Sigfox</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Ce tutoriel a été rédigé par Eugénie Vinet, stagiaire à la Direction Technique de Microsoft France de avril à août 2016 avec l’aide de son maître de stage Philippe Beraud, Chief Security Advisor à la Direction Technique.<br>Je remercie Eugénie et Philippe pour cette contribution.</p>
<h2 id="Synchroniser-une-application-de-fonction-avec-un-concentrateur-IoT"><a href="#Synchroniser-une-application-de-fonction-avec-un-concentrateur-IoT" class="headerlink" title="Synchroniser une application de fonction avec un concentrateur IoT"></a>Synchroniser une application de fonction avec un concentrateur IoT</h2><p>Pour créer une application de fonction avec Azure Function App, procédez comme suit :</p>
<p>1/    Connectez-vous au portail d’Azure à l’adresse <a target="_blank" rel="noopener" href="https://portal.azure.com/">https://portal.azure.com</a>  </p>
<p>2/    Cliquez sur <strong>New</strong> en haut à gauche et cherchez Function App. </p>
<p><img src="/images/160905a/img1.png"></p>
<p>3/     Cliquez sur <strong>create</strong>. Entrez ensuite un nom, lié le à un de vos groupes de ressources existants (ou à défaut créez-en un nouveau). Si vous voulez que votre application de fonction fonctionne en continu, choisissez un plan de service B1 associé au minimum.<br>Le portail <strong>Function App</strong> s’affiche</p>
<p><img src="/images/160905a/img2.png"></p>
<p>4/    Cliquez sur **Or create your own custom function en bas. **Une liste des modèles disponibles s’affiche pour votre application de fonction.<br><img src="/images/160905a/img3.png"></p>
<p>5/    Selon votre choix de programmation (C# ou Node) cliquez sur <strong>EventHubTrigger – C#</strong> ou <strong>EventHubTrigger – Node</strong>.<br>Azure Function App propose de déclencher une fonction à partir d’un événement dans un concentrateur d’événements, mais pas dans un concentrateur IOT; cependant, un concentrateur IOT peut être vu comme un concentrateur d’événements. C’est ce que nous allons faire. </p>
<p>6/    Précisez le nom de votre application de fonction et configurez la connexion avec votre concentrateur IoT dans <strong>Event Hub connection</strong>.<br><img src="/images/160905a/img4.png"></p>
<p>Pour connaître le nom et la chaîne de connexion du concentrateur IoT :</p>
<p>a.    Rendez-vous dans les paramètres de votre concentrateur IoT puis cliquez sur <strong>Messaging</strong>. </p>
<p>b.    Notez la valeur de <strong>Event-Hub compatible name</strong> (par exemple DecodeSigfoxHub dans notre illustration) ainsi que celle de Compatible endpoint.<br><img src="/images/160905a/img5.png"></p>
<p>c.    Toujours au niveau de votre concentrateur IoT, allez ensuite dans <strong>Shared Access Policies</strong> et copier la <strong>connection string – primary Key</strong>. Enlevez la partie HostName à la chaine de caractères de manière à ne garder que SharedAccessKeyName et SharedAccessKey.  Vous obtenez par exemple :<br><code>SharedAccessKeyName=iothubowner;SharedAccessKey=MrsSPDzU5=8g2gZZPKXOJ9EJ5RDlo2PVzmPuGniLRwQ=</code></p>
<p>d.    Retournez dans la fenêtre de votre application de fonction - ne fermez pas la fenêtre de paramètres de votre concentrateur IoT, vous en aurez besoin plus tard -. Nommez votre application de fonction comme bon vous semble :)</p>
<p>e.    Dans <strong>Event Hub Name</strong>, entrez la valeur précédente de Event-Hub compatible name. Attention cependant, il ne supporte que les noms en minuscule. S’il y a des majuscules dans votre valeur de Event hub compatible name, passez tout en minuscule (par exemple decodesigfoxhub dans notre illustration)  </p>
<p>f.    Cliquez ensuite sur <strong>select</strong> à côté de Event Hub connection. Cliquez ensuite sur** Add a connection** string en haut à droite.<br><img src="/images/160905a/img6.png"></p>
<p>g.    Dans <strong>Connection name</strong>, spécifiez le nom que vous souhaitez. </p>
<p>h.    Dans <strong>Connection string</strong>, précisez :<br><code>Endpoint=&lt;CompatibleEndpoint&gt;&lt;SharedAccessKeyName&gt;&lt;SharedAccessKey&gt;</code><br>Vous obtenez une chaine de caractère semblable à :<br><code>Endpoint=sb://iothub-ns-decodesigf-499548662a53f6c.servicebus.windows.net/;SharedAccessKeyName=iothubowner;SharedAccessKey=MrsSPDzU5=8g2gZZPKXOJ9EJ5RDlo2PVzmPuGniLRwQ=</code></p>
<p>7/    Validez.<br>Votre application de fonction s’exécutera alors à chaque message reçu par l’utilisateur.<br>Vous pouvez alors modifier les informations que vous recevez de votre concentrateur IoT pour les renvoyer autre part ou les stocker par exemple.<br>Vous trouverez ci-après un exemple concret d’usage d’une application de fonction dans notre contexte, à savoir le décodage de trames Sigfox pour les renvoyer sur la solution préconfigurée de surveillance à distance (Cf. portail associé à l’adresse <a target="_blank" rel="noopener" href="https://www.azureiotsuite.com/">https://www.azureiotsuite.com/</a>) . </p>
<h2 id="Exemple-avec-IoT-Suie-Objet-Sigfox"><a href="#Exemple-avec-IoT-Suie-Objet-Sigfox" class="headerlink" title="Exemple avec IoT Suie - Objet Sigfox"></a>Exemple avec IoT Suie - Objet Sigfox</h2><p>Nous vous proposons dans cette section un exemple de projet utilisant Azure Function App avec un concentrateur IoT.<br>La solution préconfigurée de surveillance à distance s’attend recevoir des messages sur son concentrateur IoT de type :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	DeviceId &#x3D; XX,</span><br><span class="line">	Humidity &#x3D; XX,</span><br><span class="line">	Temperature &#x3D; XX,</span><br><span class="line">	ExternalTemperature &#x3D; XX</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dans ce projet nous voulons utiliser des objets Sigfox (voir ici <a target="_blank" rel="noopener" href="http://makers.sigfox.com/#about">http://makers.sigfox.com/#about</a>) qui envoient des trames de type :<br>« 422D17 » avec 42 l’identifiant du type d’objet, 2D l’humidité (45%) et 17 la température (en décimal = 23°C). »<br>On va supposer que l’humidité et la température sont deux entiers qui vont de 0 à 100. </p>
<h3 id="Prerequis"><a href="#Prerequis" class="headerlink" title="Prérequis"></a>Prérequis</h3><p>Les prérequis sont les suivants :<br>•    Avoir lié un device Sigfox qui envoie des données de température et d’humidité, Cf. tutoriel <a target="_blank" rel="noopener" href="http://danvy.tv/push-your-sigfox-devices-data-to-azure-iot-hub/">PUSH YOUR SIGFOX DEVICES DATA TO AZURE IOT HUB</a> .</p>
<p>•    Avoir créé et provisionné une solution préconfigurée de type Solution de surveillance à distance sur le site dédié à l’adresse <a target="_blank" rel="noopener" href="http://www.azureiotsuite.com/">http://www.azureiotsuite.com/</a>.</p>
<p>•    Avoir suivi l’étape précédente de synchronisation d’une Function App avec un <strong>concentrateur IoT en utilisant le concentrateur IoT Hub lié à l’objet Sigfox</strong>. </p>
<p>Si ces prérequis sont satisfaits, les étapes de mise en œuvre sont les suivantes :</p>
<p>•    Etape 1 – Ajout de l’objet préconfiguré.</p>
<p>•    Etape 2 – Remplissage du fichier JSON.</p>
<p>•    Etape 3 – Ajout des paquets.</p>
<p>•    Etape 4 – Contenu de votre application de fonction.</p>
<p>Nous les développons dans l’ordre au travers d’une section dédiée propre.</p>
<h3 id="Etape-1-–-Ajout-de-l’objet-preconfigure"><a href="#Etape-1-–-Ajout-de-l’objet-preconfigure" class="headerlink" title="Etape 1 – Ajout de l’objet préconfiguré"></a>Etape 1 – Ajout de l’objet préconfiguré</h3><p>Pour ajouter un objet, procédez comme suit :</p>
<ol>
<li>Rendez-vous à présent sur l’environnement de démonstration iotmsfrance à l’adresse <a target="_blank" rel="noopener" href="https://www.azureiotsuite.com/">https://www.azureiotsuite.com/</a>. </li>
<li>Connectez-vous avec votre compte. Comme cela a été indiqué précédemment, vous devez disposer de privilèges d’administration pour pouvoir enregistrer un objet.<br>De plus, réalisez cette étape UNIQUEMENT si l’objet n’apparait pas dans la liste des appareils du concentrateur IoT de l’environnement de démonstration (vous pouvez vérifié via le portail Azure ou via l’application <strong>Device Explorer</strong>). Si votre objet est déjà présent dans la liste, il faudra le supprimer en utilisant le <strong>Device Explorer</strong>.<br>L’application <strong>Device Explorer</strong> est téléchargeable à l’adresse <a target="_blank" rel="noopener" href="https://github.com/Azure/azure-iot-sdks/releases">https://github.com/Azure/azure-iot-sdks/releases</a>. Le répertoire d’installation par défaut de cette application est :<br>C:\Program Files (x86)\Microsoft\DeviceExplorer</li>
<li>Une fois sur le site, dans la liste des solutions approvisionnées, sélectionnez la <strong>Solution de surveillance à distance</strong>, c.à.d. la solution <VotreSolution>.azurewebsite.net.</li>
<li>Cliquez en bas à gauche sur <strong>Ajouter un appareil</strong> (ou Add a device en anglais).<br><img src="/images/160905a/img7.png"><br>L’étape 1 d’ajout d’un appareil s’affiche.<br><img src="/images/160905a/img8.png"></li>
<li>Dans le cadre <strong>Appareil personnalisé</strong>, sélectionnez <strong>Ajouter un nouveau</strong>. L’étape 2 s’affiche.<br><img src="/images/160905a/img9.png"></li>
<li>Sélectionnez l’option <strong>Me laisser définir mon propre ID d’appareil</strong> et donnez lui le même ID que dans Sigfox /!\ ça ne marchera pas si vous choisissez un id différent.  </li>
<li>Cliquez sur <strong>Vérifier l’ID</strong>. L’ID doit être disponible. </li>
<li>Cliquez enfin sur <strong>Créer</strong>.<br>A ce stade, l’objet n’est pas activé dans la plateforme. Il va falloir modifier les informations relatives à l’objet dans la base NoSQL DocumentDB. Pour cela, connectez-vous au portail d’Azure à l’adresse <a target="_blank" rel="noopener" href="https://portal.azure.com/">https://portal.azure.com</a>  et réalisez l’étape suivante.  </li>
</ol>
<h2 id="Etape-2-–-Remplissage-du-fichier-JSON"><a href="#Etape-2-–-Remplissage-du-fichier-JSON" class="headerlink" title="Etape 2 – Remplissage du fichier JSON"></a>Etape 2 – Remplissage du fichier JSON</h2><p>Pour remplir le fichier JSON d’informations lié à l’objet, procédez comme suit :</p>
<ol>
<li>Rendez-vous dans la rubrique DocumentDB Accounts sur le portail Azure à l’adresse <a target="_blank" rel="noopener" href="https://portal.azure.com/">https://portal.azure.com</a>.  <img src="/images/160905a/img10.png"></li>
<li>Sélectionner le compte DocumentDB du projet :<br><img src="/images/160905a/img11.png"></li>
<li>Cliquez ensuite sur votre base de données DevMgmtDb (1). Dans <strong>DevMgmtDB</strong>, cliquez sur <strong>Document Explorer</strong> (2).  <img src="/images/160905a/img12.png"><br>Vous devriez voir apparaitre une liste comme celle-ci : </li>
</ol>
<pre><code>&#123;
    &quot;DeviceProperties&quot;: &#123;
    &quot;DeviceID&quot;: &quot;&#123;NomDeVotreDevice&#125;&quot;,
    &quot;HubEnabledState&quot;: true,
    &quot;CreatedTime&quot;: &quot;0001-01-01T00:00:00&quot;,
    &quot;DeviceState&quot;: &quot;normal&quot;,
    &quot;Manufacturer&quot;: &quot;&#123;Manufacturer&#125;&quot;,
    &quot;ModelNumber&quot;: &quot;&#123;NomDuModelDuDevice&#125;&quot;,
    &quot;SerialNumber&quot;: &quot;&#123;NumeroDeSérie&#125;&quot;,
    &quot;FirmwareVersion&quot;: &quot;&#123;FirmwareVersion&#125;&quot;,
    &quot;Platform&quot;: &quot;&#123;Plateform&#125;&quot;,
    &quot;Latitude&quot;: &#123;Longitude&#125; ,
    &quot;Longitude&quot;: &#123;Latitude&#125;,
    &quot;Processor&quot;: &quot;&#123;processor&#125;&quot;,
    &quot;InstalledRAM&quot;: &quot;&#123;installedRam&#125;&quot;,
&#125;,
&quot;SystemProperties&quot;: &#123;
    &quot;ICCID&quot;: null
&#125;,
 &quot;Commands&quot;: [
    &#123;
      &quot;Name&quot;: &quot;PingDevice&quot;,
      &quot;Parameters&quot;: null
    &#125;,
    &#123;
      &quot;Name&quot;: &quot;StartTelemetry&quot;,
      &quot;Parameters&quot;: null
    &#125;,
&#123;
  &quot;Name&quot;: &quot;StopTelemetry&quot;,
  &quot;Parameters&quot;: null
&#125;,
&#123;
  &quot;Name&quot;: &quot;ChangeSetPointTemp&quot;,
  &quot;Parameters&quot;: [
    &#123;
      &quot;Name&quot;: &quot;SetPointTemp&quot;,
      &quot;Type&quot;: &quot;double&quot;
    &#125;
  ]
&#125;,
&#123;
  &quot;Name&quot;: &quot;DiagnosticTelemetry&quot;,
  &quot;Parameters&quot;: [
    &#123;
      &quot;Name&quot;: &quot;Active&quot;,
      &quot;Type&quot;: &quot;boolean&quot;
    &#125;
  ]
&#125;,
&#123;
  &quot;Name&quot;: &quot;ChangeDeviceState&quot;,
  &quot;Parameters&quot;: [
    &#123;
      &quot;Name&quot;: &quot;DeviceState&quot;,
      &quot;Type&quot;: &quot;string&quot;
    &#125;
  ]
&#125;
],
&quot;CommandHistory&quot;: [],
&quot;IsSimulatedDevice&quot;: 0,
 &quot;id&quot;: &quot;&quot;,
 &quot;Telemetry&quot;: [
    &#123;
  &quot;Name&quot;: &quot;Temperature&quot;,
  &quot;DisplayName&quot;: &quot;Temperature&quot;,
  &quot;Type&quot;: &quot;double&quot;
&#125;,
&#123;
  &quot;Name&quot;: &quot;Humidity&quot;,
  &quot;DisplayName&quot;: &quot;Humidity&quot;,
  &quot;Type&quot;: &quot;double&quot;
&#125;
],
 &quot;Version&quot;: &quot;1.0&quot;,
 &quot;ObjectType&quot;: &quot;DeviceInfo&quot;
 &#125;
&#125;</code></pre>
<p>Si vous n’avez pas réalisé l’étape 3 si l’objet existait déjà dans le concentrateur IoT, il est possible qu’il n’y ait aucun fichier relatif à l’objet dans la base de données. Il va alors falloir en créer un en cliquant en haut à gauche.<br>Par contre si vous aviez réalisé l’étape 3, le fichier relatif au device devrait se trouver dans la liste. Il devrait avoir un nom de type « 2f23278e-0e82-4850-86f5-b5c3f83a8850 » ou bien le nom du device comme « BFFBA ».  Pour vérifier si un fichier est lié à votre objet, il suffit de l’ouvrir et de lire le DeviceID. Il doit être identique à l’ID que vous avez enregistré sur la page web de la solution de surveillance à distance et identique à l’ID de l’objet enregistré sur le portail Sigfox. (1)<br>Supprimez ou modifiez le contenu du fichier dont le DeviceID est le nom de votre objet et recopier le texte à droite puis complétez/modifiez les zones en jaune comme suit :</p>
<pre><code>    HubEnabledState : doit être passé à true.
    DeviceState : doit être normal. 
    CreatedTime : doit être de la forme : AAAA-MM-JJThh:mm:ss 
Avec AAAA l’année, MM le mois, JJ le jour, hh l’heure, mm les minutes et ss les secondes. 
Il est recommandé de mettre la date et l’heure qu’il est au moment où vous remplissez le fichier mais cela ne va pas avoir d’impact sur le fonctionnement général de la surveillance à distance. 
    SerialNumber : doit préciser le numéro de série de l’objet si celui en est « équipé ». A défaut, écrivez le nom de l’objet entre guillemets.
    Manufacturer : doit préciser le nom du fabricant de l’objet entre guillemets.
    ModelNumber : doit préciser le numéro de modèle de l’objet si celui en est « équipé ». A défaut, écrivez le nom de l’objet entre guillemets
    FirmwareVersion, Platform, Processor et InstalledRam : si vous ne les connaissez pas pour le device utilisé vous pouvez écrire « None ». 
    Latitude et Longitude : vous avez le choix de son emplacement. L’objet s’affichera à l’endroit indiqué sur la carte. Vous pouvez vous aider de ce site : http://www.latlong.net/ pour trouver la longitude et la latitude d’un endroit précis. Attention : la longitude et la latitude ne doivent pas être écrites entre guillemets sur le document. 
    Id : sera l’ID du document que vous avez créé/modifié. Il est recommandé d’utiliser le nom de l’objet afin de retrouver plus facilement le document. </code></pre>
<h2 id="Etape-3-Ajout-des-paquets"><a href="#Etape-3-Ajout-des-paquets" class="headerlink" title="Etape 3 - Ajout des paquets"></a>Etape 3 - Ajout des paquets</h2><p>Tout d’abord nous allons ajouter les paquets nécessaires à notre application de fonction. Pour ceci, nous allons suivre les étapes pour charger un fichier project.json contenant le nom de tous nos paquets (rubrique Package Management sur le site <a target="_blank" rel="noopener" href="https://azure.microsoft.com/en-us/documentation/articles/functions-reference-csharp/">https://azure.microsoft.com/en-us/documentation/articles/functions-reference-csharp/</a> et File Update ici <a target="_blank" rel="noopener" href="https://azure.microsoft.com/en-us/documentation/articles/functions-reference/#fileupdate">https://azure.microsoft.com/en-us/documentation/articles/functions-reference/#fileupdate</a> ).<br>Procédez comme suit :</p>
<ol>
<li><p>Rendez-vous dans les outils de votre application de fonction.<br><img src="/images/160905a/img13.png"></p>
</li>
<li><p>Cliquez sur Kudu puis sur accédez. Vous vous retrouvez donc sur le système de gestion des fichiers de votre application de fonction. </p>
</li>
<li><p>Allez dans Debug Console puis PowerShell. En utilisant la commande ou bien en utilisant l’explorateur de fichier au-dessus rendez-vous sur D:\home\site\wwwroot&lt;NomdevotreApplicationDeFonction&gt;&gt;</p>
</li>
<li><p>Ajoutez alors un fichier project.json qui contient les lignes suivantes - un simple glissé-déposé suffit - :  </p>
<p>  {<br>  “frameworks”: {<br>  “net46”:{</p>
<pre><code>  &quot;dependencies&quot;: &#123;                                                
          &quot;Microsoft.Azure.Devices.Client&quot;:&quot;1.0.6&quot;,
          &quot;Newtonsoft.Json&quot;:&quot;8.0.3&quot;,                
          &quot;Microsoft.Azure.Devices&quot;:&quot;1.0.6&quot;            
          &#125;
      &#125;      
  &#125;</code></pre>
<p>  }</p>
</li>
</ol>
<h2 id="Etape-4-–-Definition-du-contenu-de-votre-application-de-fonction"><a href="#Etape-4-–-Definition-du-contenu-de-votre-application-de-fonction" class="headerlink" title="Etape 4 – Définition du contenu de votre application de fonction"></a>Etape 4 – Définition du contenu de votre application de fonction</h2><p>Pour définir le contenu de votre application de fonction, procédez comme suit :</p>
<p>1/    Retournez sur votre application de fonction et ajoutez la classe <strong>DataToReceive</strong>. Le contenu dépendra du contenu du JSON entré pour le callback de votre Device Type dans le portail Sigfox.<br>Si vous avez par exemple ce JSON : </p>
<pre><code>&#123;
   &quot;device&quot; : &quot;&#123;device&#125;&quot;,
   &quot;data&quot; : &quot;&#123;data&#125;&quot;,
   &quot;time&quot; : &#123;time&#125;,
   &quot;snr&quot; : &#123;snr&#125;,
   &quot;station&quot; : &quot;&#123;station&#125;&quot;,
   &quot;rssi&quot; : &#123;rssi&#125;,
   &quot;seqNumber&quot; : &#123;seqNumber&#125;
&#125;</code></pre>
<p>Votre classe <strong>DataToReceive</strong> doit ressembler à cela : </p>
<pre><code>public class DataToReceive
&#123;
    public string device &#123; get; set; &#125;
    public string data &#123; get; set; &#125;
    public double time &#123; get; set; &#125;
    public string seqNumber &#123; get; set; &#125;
    public string rssi &#123; get; set; &#125;
    public string snr &#123; get; set; &#125;
    public string station &#123; get; set; &#125;
&#125;</code></pre>
<p>Il faut qu’il y ait au minimum les variables « device » et « data ». </p>
<p>2/    Créer ensuite une classe <strong>DataToSend</strong> qui réunira les informations que vous voulez envoyer dans votre solution préconfigurée de surveillance à distance. Nous envoyons ici que l’Id de l’objet, la température et l’humidité. Vous pouvez ajouter le paramètre <strong>External Température</strong>. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class DataToSend</span><br><span class="line">&#123;</span><br><span class="line">    public string DeviceId &#123; get; set; &#125;</span><br><span class="line">    public double Humidity &#123; get; set; &#125;</span><br><span class="line">    public double Temperature &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3/    Créez la classe <strong>SendToIotHub</strong> comme suit. Remplacez bien les valeurs de <strong>connectionString</strong> et d’<strong>iotHubUri</strong> par les éléments relatifs au concentrateur IoT de la solution préconfigurée.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public class SendToIotHub</span><br><span class="line">&#123;</span><br><span class="line">    DeviceClient deviceClient;</span><br><span class="line">    Device device;</span><br><span class="line">    string jsonMessageToSend;</span><br><span class="line">    string connectionString &#x3D; &quot;&#123;IotHubConnexionString&#125;&quot;;</span><br><span class="line">    string iotHubUri &#x3D; &quot;&#123;IotHubName&#125;.azure-devices.net&quot;;</span><br><span class="line"></span><br><span class="line">    public async void sendData(DataToSend data, TraceWriter log)</span><br><span class="line">    &#123;</span><br><span class="line">        RegistryManager registryManager &#x3D; RegistryManager.CreateFromConnectionString(connectionString);</span><br><span class="line">        device &#x3D; new Device(data.DeviceId);</span><br><span class="line">        device &#x3D; await AddDeviceAsync1(data.DeviceId, registryManager);</span><br><span class="line">        deviceClient &#x3D; DeviceClient.Create(iotHubUri, new DeviceAuthenticationWithRegistrySymmetricKey(data.DeviceId,device.Authentication.SymmetricKey.PrimaryKey.ToString()));</span><br><span class="line">       jsonMessageToSend &#x3D; JsonConvert.SerializeObject(data);</span><br><span class="line">        var messageToSend &#x3D; new Microsoft.Azure.Devices.Client.Message(System.Text.Encoding.ASCII.GetBytes(jsonMessageToSend));</span><br><span class="line"></span><br><span class="line">        deviceClient.SendEventAsync(messageToSend);</span><br><span class="line">        log.Info($&quot;C# Event Hub trigger function processed a message: &#123;jsonMessageToSend&#125;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        private async Task&lt;Device&gt; AddDeviceAsync1(string deviceId, RegistryManager registryManager)</span><br><span class="line">        &#123;</span><br><span class="line">            Device device;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                device &#x3D; await registryManager.AddDeviceAsync(new Device(deviceId));</span><br><span class="line">    </span><br><span class="line">            &#125;</span><br><span class="line">            catch (DeviceAlreadyExistsException)</span><br><span class="line">            &#123;</span><br><span class="line">                device &#x3D; await registryManager.GetDeviceAsync(deviceId);</span><br><span class="line">            &#125;</span><br><span class="line">            return device;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>4/    Ajoutez les directives using « de circonstance » au début de votre application de fonction :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.Azure.Devices;</span><br><span class="line">using Microsoft.Azure.Devices.Client;</span><br><span class="line">using System;</span><br><span class="line">using Microsoft.Azure.Devices.Common.Exceptions;</span><br><span class="line">using Newtonsoft.Json;</span><br></pre></td></tr></table></figure>

<p>5/    Complétez maintenant la méthode <strong>Run</strong> : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public static void Run(string myEventHubMessage, TraceWriter log)</span><br><span class="line">&#123;</span><br><span class="line">    log.Info($&quot;C# Event Hub trigger function processed a message: &#123;myEventHubMessage&#125;&quot;);</span><br><span class="line"></span><br><span class="line">    DataToReceive receivedData &#x3D; new DataToReceive();</span><br><span class="line">    DataToSend sentData &#x3D; new DataToSend();</span><br><span class="line">    SendToIotHub sendDataToIotHub &#x3D; new SendToIotHub();</span><br><span class="line">    receivedData &#x3D; JsonConvert.DeserializeObject&lt;DataToReceive&gt;(myEventHubMessage);</span><br><span class="line"></span><br><span class="line">    if (receivedData.data !&#x3D; null &amp;&amp; receivedData.data.Substring(0, 2) &#x3D;&#x3D; &quot;42&quot;)</span><br><span class="line">    &#123;</span><br><span class="line">            string data &#x3D; receivedData.data;</span><br><span class="line">            sentData.Humidity &#x3D; Convert.ToInt32(data.Substring(2, 2), 16);</span><br><span class="line">            sentData.Temperature &#x3D; Convert.ToInt32(data.Substring(4, 2), 16);</span><br><span class="line">            sentData.DeviceId &#x3D; receivedData.device;</span><br><span class="line">            sendDataToIotHub.sendData(sentData, log);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vous obtiendrez quelque chose de similaire à la capture qui suit si tout va bien :</p>
<p><img src="/images/160905a/img14.png"></p>
<p>Vous devriez voir dans les logs les messages reçus et envoyés si vous gardez les lignes de code <code>log.info (…..)</code>. </p>
<p>Bien sûr, nous partons du principe que les trames à utiliser sont de la forme <strong>« 422D17 »</strong> (comme développé précédemment) mais il est possible que vous ayez à faire des calculs sur chaque élément de votre trame pour obtenir les valeurs décimales renvoyées par vos capteurs. Pour ceci, renseignez-vous auprès du constructeur de l’objet.  </p>
<p>Et voilà !<br>Ceci conclut ce tutoriel.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.3-4.fr/2016/09/05/IOT_Hub_Azure_Functions_Sigfox/" data-id="ckq2umidb00157nndfrk1gbxr" class="article-share-link">Share</a>
      
        <a href="https://blog.3-4.fr/2016/09/05/IOT_Hub_Azure_Functions_Sigfox/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Azure/" rel="tag">Azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AzureFunctions/" rel="tag">AzureFunctions</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IoT/" rel="tag">IoT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sigfox/" rel="tag">Sigfox</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2016/08/30/deploying_containers_to_one_or_several_VMs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/30/deploying_containers_to_one_or_several_VMs/" class="article-date">
  <time datetime="2016-08-31T00:00:00.000Z" itemprop="datePublished">2016-08-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/30/deploying_containers_to_one_or_several_VMs/">Deploying Containers to One or Several VMs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Here is a sample test to show how Docker Swarm and Docker Compose simplify network management. </p>
<p>We’ll deploy a topology of 3 containers and see how they can reach each other. In the first case, we deploy it on a single node. In the second case, we deploy it on a 2 host swarm cluster.</p>
<p>The Swarm cluster is created as a Swarm Azure Container Service instance with the main following parameters: </p>
<ul>
<li>Orchestrator configuration: Swarm (btw, other option for ACS is DC/OS)</li>
<li>Agent count: 2</li>
<li>Agent virtual machine size: (leave default)</li>
<li>Master count: 1</li>
<li>DNS prefix for container service: myacs</li>
</ul>
<p>Two files are created</p>
<p>The Dockerfile contains: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;init&quot;]</span><br></pre></td></tr></table></figure>

<p>The docker-compose.yml file has the following content: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;2&#39;</span><br><span class="line">services:</span><br><span class="line">  node1:</span><br><span class="line">    build: .</span><br><span class="line">    container_name: n1</span><br><span class="line">  node2:</span><br><span class="line">    build: .</span><br><span class="line">    container_name: n2</span><br><span class="line">  node3:</span><br><span class="line">    build: .</span><br><span class="line">    container_name: n3</span><br></pre></td></tr></table></figure>

<h2 id="on-a-single-box"><a href="#on-a-single-box" class="headerlink" title="on a single box"></a>on a single box</h2><p>Here is what I get on the single box: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">benjguin@benjguinu1605a:~&#x2F;simpletest$ docker-compose up -d</span><br><span class="line">Creating network &quot;simpletest_default&quot; with the default driver</span><br><span class="line">Creating n1</span><br><span class="line">Creating n3</span><br><span class="line">Creating n2</span><br><span class="line">benjguin@benjguinu1605a:~&#x2F;simpletest$ docker-compose ps</span><br><span class="line">Name   Command   State   Ports</span><br><span class="line">------------------------------</span><br><span class="line">n1     init      Up</span><br><span class="line">n2     init      Up</span><br><span class="line">n3     init      Up</span><br><span class="line">benjguin@benjguinu1605a:~&#x2F;simpletest$ docker exec n1 ping -c 2 n2</span><br><span class="line">PING n2 (172.19.0.4): 56 data bytes</span><br><span class="line">64 bytes from 172.19.0.4: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.086 ms</span><br><span class="line">64 bytes from 172.19.0.4: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.067 ms</span><br><span class="line"></span><br><span class="line">--- n2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.067&#x2F;0.076&#x2F;0.086 ms</span><br><span class="line">benjguin@benjguinu1605a:~&#x2F;simpletest$ docker exec n1 ping -c 2 n3</span><br><span class="line">PING n3 (172.19.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.19.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.072 ms</span><br><span class="line">64 bytes from 172.19.0.3: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.072 ms</span><br><span class="line"></span><br><span class="line">--- n3 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.072&#x2F;0.072&#x2F;0.072 ms</span><br><span class="line">benjguin@benjguinu1605a:~&#x2F;simpletest$ docker exec n3 ping -c 2 n1</span><br><span class="line">PING n1 (172.19.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.19.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.051 ms</span><br><span class="line">64 bytes from 172.19.0.2: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.060 ms</span><br><span class="line"></span><br><span class="line">--- n1 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.051&#x2F;0.055&#x2F;0.060 ms</span><br></pre></td></tr></table></figure>

<h2 id="on-a-Swarm-cluster"><a href="#on-a-Swarm-cluster" class="headerlink" title="on a Swarm cluster"></a>on a Swarm cluster</h2><p>Let’s now do the same from the master node of my ACS cluster.</p>
<p>network information was added to the docker-compose.yml file: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;2&#39;</span><br><span class="line">services:</span><br><span class="line">  node1:</span><br><span class="line">    build: .</span><br><span class="line">    container_name: n1</span><br><span class="line">    networks:</span><br><span class="line">      - net34</span><br><span class="line">  node2:</span><br><span class="line">    build: .</span><br><span class="line">    container_name: n2</span><br><span class="line">    networks:</span><br><span class="line">      - net34</span><br><span class="line">  node3:</span><br><span class="line">    build: .</span><br><span class="line">    container_name: n3</span><br><span class="line">    networks:</span><br><span class="line">      - net34</span><br><span class="line">networks:</span><br><span class="line">  net34:</span><br><span class="line">    driver: overlay</span><br></pre></td></tr></table></figure>

<p>and here is the result of the test:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">export DOCKER_HOST&#x3D;172.16.0.5:2375</span><br><span class="line"></span><br><span class="line">benjguin@swarm-master-B295EC2C-0:~$ docker-compose up -d</span><br><span class="line">Creating network &quot;benjguin_net34&quot; with driver &quot;overlay&quot;</span><br><span class="line">Creating n1</span><br><span class="line">Creating n3</span><br><span class="line">Creating n2</span><br><span class="line">benjguin@swarm-master-B295EC2C-0:~$ docker inspect n1 | grep swarm-agent</span><br><span class="line">            &quot;Name&quot;: &quot;swarm-agent-B295EC2C000001&quot;,</span><br><span class="line">benjguin@swarm-master-B295EC2C-0:~$ docker inspect n2 | grep swarm-agent</span><br><span class="line">            &quot;Name&quot;: &quot;swarm-agent-B295EC2C000000&quot;,</span><br><span class="line">benjguin@swarm-master-B295EC2C-0:~$ docker inspect n3 | grep swarm-agent</span><br><span class="line">            &quot;Name&quot;: &quot;swarm-agent-B295EC2C000000&quot;,</span><br><span class="line"></span><br><span class="line">benjguin@swarm-master-B295EC2C-0:~$ docker exec n2 ping -c 2 n1</span><br><span class="line">PING n1 (10.0.0.2): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;1.088 ms</span><br><span class="line">64 bytes from 10.0.0.2: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.830 ms</span><br><span class="line"></span><br><span class="line">--- n1 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.830&#x2F;0.959&#x2F;1.088 ms</span><br><span class="line">benjguin@swarm-master-B295EC2C-0:~$ docker exec n1 ping -c 2 n2</span><br><span class="line">PING n2 (10.0.0.4): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.4: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.671 ms</span><br><span class="line">64 bytes from 10.0.0.4: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.695 ms</span><br><span class="line"></span><br><span class="line">--- n2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.671&#x2F;0.683&#x2F;0.695 ms</span><br><span class="line">benjguin@swarm-master-B295EC2C-0:~$ docker exec n1 ping -c 2 n3</span><br><span class="line">PING n3 (10.0.0.3): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;1.050 ms</span><br><span class="line">64 bytes from 10.0.0.3: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.783 ms</span><br><span class="line"></span><br><span class="line">--- n3 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.783&#x2F;0.916&#x2F;1.050 ms</span><br><span class="line">benjguin@swarm-master-B295EC2C-0:~$ docker exec n2 ping -c 2 n3</span><br><span class="line">PING n3 (10.0.0.3): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.068 ms</span><br><span class="line">64 bytes from 10.0.0.3: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.076 ms</span><br><span class="line"></span><br><span class="line">--- n3 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.068&#x2F;0.072&#x2F;0.076 ms</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>We have containers in a common network which is described only thru docker means.<br>This works on a single host, and also on multiple hosts (in the example, a host had 1 container, another host had 2 of the 3 containers).</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.3-4.fr/2016/08/30/deploying_containers_to_one_or_several_VMs/" data-id="ckq2umid0000a7nnd5jglauhh" class="article-share-link">Share</a>
      
        <a href="https://blog.3-4.fr/2016/08/30/deploying_containers_to_one_or_several_VMs/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Azure/" rel="tag">Azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__(&#39;next&#39;) &amp;raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure/" rel="tag">Azure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure-Machine-Learning/" rel="tag">Azure Machine Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AzureFunctions/" rel="tag">AzureFunctions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Big-Data/" rel="tag">Big Data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BigData/" rel="tag">BigData</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Containers/" rel="tag">Containers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Science/" rel="tag">Data Science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevEnv/" rel="tag">DevEnv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/" rel="tag">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevPractices/" rel="tag">DevPractices</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/" rel="tag">Hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IoT/" rel="tag">IoT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sigfox/" rel="tag">Sigfox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VisualStudioCode/" rel="tag">VisualStudioCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Azure/" style="font-size: 20px;">Azure</a> <a href="/tags/Azure-Machine-Learning/" style="font-size: 10px;">Azure Machine Learning</a> <a href="/tags/AzureFunctions/" style="font-size: 10px;">AzureFunctions</a> <a href="/tags/Big-Data/" style="font-size: 16.67px;">Big Data</a> <a href="/tags/BigData/" style="font-size: 10px;">BigData</a> <a href="/tags/Containers/" style="font-size: 10px;">Containers</a> <a href="/tags/Data-Science/" style="font-size: 13.33px;">Data Science</a> <a href="/tags/DevEnv/" style="font-size: 10px;">DevEnv</a> <a href="/tags/DevOps/" style="font-size: 10px;">DevOps</a> <a href="/tags/DevPractices/" style="font-size: 10px;">DevPractices</a> <a href="/tags/Hadoop/" style="font-size: 13.33px;">Hadoop</a> <a href="/tags/IoT/" style="font-size: 13.33px;">IoT</a> <a href="/tags/Sigfox/" style="font-size: 10px;">Sigfox</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/VisualStudioCode/" style="font-size: 10px;">VisualStudioCode</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/12/end-to-end-walkthrough/">Why You Might Want to Have an End to End Walkthrough Document in Your Repo</a>
          </li>
        
          <li>
            <a href="/2020/09/02/docker-volumes-in-codespace/">How to Share a Volume With a Specific Docker Container in Visual Studio Codespaces</a>
          </li>
        
          <li>
            <a href="/2016/12/12/Sample_Flink_Code/">Sample Flink Code That Reads From Kafka and Writes to Cassandra</a>
          </li>
        
          <li>
            <a href="/2016/09/05/IOT_Hub_Azure_Functions_Sigfox/">Tutoriel - Synchronisation De Votre Application De Fonction Avec Le Concentrateur IoT Et Exemple De Connexion Avec Un Objet Sigfox</a>
          </li>
        
          <li>
            <a href="/2016/08/30/deploying_containers_to_one_or_several_VMs/">Deploying Containers to One or Several VMs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Benjamin Guinebertière<br>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'benjguin-blog34';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>